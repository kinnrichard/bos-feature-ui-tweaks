# Story 008.1: Implement ReactiveRecord Base Class

## Status
InProgress

## Story
**As a** frontend developer using Svelte components,
**I want** a ReactiveRecord base class that provides Rails-like reactive queries,
**so that** I can use familiar Rails patterns while getting automatic UI updates when data changes.

## Acceptance Criteria

1. **ReactiveRecord Base Class Implementation**
   - Create `frontend/src/lib/models/base/reactive-record.ts` following Epic-008 specification
   - Provide identical API to ActiveRecord but return ReactiveQuery objects instead of Promises
   - Support all Rails-style methods: `find()`, `where()`, `all()`, `kept()`, `discarded()`, `withDiscarded()`
   - Integrate with Svelte 5 runes for reactive state management

2. **ReactiveQuery Integration**
   - ReactiveRecord methods return ReactiveQuery<T> objects compatible with existing ReactiveQuery implementation
   - Support method chaining with reactive scoped queries
   - Maintain 5-minute TTL caching as per current ReactiveTask implementation
   - Provide `.data`, `.isLoading`, `.error` reactive properties

3. **Type Safety and Rails Compatibility**
   - Full TypeScript support with proper generics `ReactiveRecord<T extends BaseRecord>`
   - Type-safe query building without `as any` casts
   - Follow exact same method signatures as ActiveRecord for API consistency
   - Support Rails discard gem patterns reactively

4. **Integration with Zero.js**
   - Seamless integration with existing Zero.js client (`getZero()`)
   - Proper error handling matching ActiveRecord patterns
   - Support for Zero.js query building and materialization
   - Maintain existing Zero.js reactive view lifecycle management

5. **Documentation and Examples**
   - Comprehensive JSDoc documentation with Svelte usage examples
   - Clear import patterns for reactive vs non-reactive contexts
   - Usage examples showing Svelte 5 integration patterns

## Tasks / Subtasks

- [ ] **Create ReactiveRecord Base Class** (AC: 1, 3)
  - [ ] Create `frontend/src/lib/models/base/reactive-record.ts`
  - [ ] Implement abstract class `ReactiveRecord<T extends BaseRecord>`
  - [ ] Add static methods returning ReactiveQuery objects:
    - [ ] `find(id: string): ReactiveQuery<T | null>`
    - [ ] `where(conditions: Partial<T>): ReactiveQuery<T[]>`
    - [ ] `all(): ReactiveQuery<T[]>`
    - [ ] `kept(): ReactiveQuery<T[]>`
    - [ ] `discarded(): ReactiveQuery<T[]>`
    - [ ] `withDiscarded(): ReactiveQuery<T[]>`
  - [ ] Add configuration interface `ReactiveRecordConfig`
  - [ ] Implement proper TypeScript generics and type safety

- [ ] **ReactiveQuery Integration** (AC: 2)
  - [ ] Create `ReactiveScopedQuery<T>` class for method chaining
  - [ ] Implement reactive query building with Zero.js integration
  - [ ] Add method chaining support: `where()`, `orderBy()`, `limit()`, `offset()`
  - [ ] Integrate with existing ReactiveQuery and ReactiveQueryOne classes
  - [ ] Set up 5-minute TTL caching matching current implementation

- [ ] **Zero.js Integration** (AC: 4)
  - [ ] Implement `executeReactiveQuery()` method using `getZero()`
  - [ ] Add error handling matching ActiveRecord patterns
  - [ ] Support Zero.js view lifecycle (creation, destruction, refresh)
  - [ ] Handle connection availability and disconnection scenarios
  - [ ] Implement query materialization and reactive updates

- [ ] **Testing Infrastructure** (AC: 1, 2, 3, 4)
  - [ ] Update `frontend/tests/epic-008-reactive-record.spec.ts` with implementation tests
  - [ ] Create reactive query testing utilities
  - [ ] Add integration tests with Zero.js mocking
  - [ ] Test Svelte 5 integration patterns
  - [ ] Add performance tests comparing to current ReactiveTask implementation

- [ ] **Documentation and Examples** (AC: 5)
  - [ ] Add comprehensive JSDoc documentation
  - [ ] Create Svelte usage examples in documentation
  - [ ] Document import patterns for reactive vs non-reactive contexts
  - [ ] Add migration guide from current ReactiveTask pattern

## Dev Notes

### Relevant Source Tree Information

**Epic-008 Specification**: `/Users/claude/code/bos/docs/epics/completed/Epic-008-Simplify-ReactiveRecord-Version-2.md`
- Lines 276-295 specify ReactiveRecord base class requirements
- Lines 198-213 show ReactiveQuery integration patterns
- Lines 351-363 show expected ReactiveTask implementation using base class

**Existing ActiveRecord Implementation**: `frontend/src/lib/models/base/active-record.ts`
- Lines 239-435 contain complete ActiveRecord implementation to mirror
- Lines 66-223 show ScopedQuery implementation pattern to follow for reactive version
- Lines 37-61 show error handling patterns to maintain

**Current ReactiveTask Implementation**: `frontend/src/lib/models/reactive-task.ts`
- Lines 56-149 show current hybrid pattern to replace
- Lines 62-71 show ReactiveQueryOne usage pattern
- Lines 77-127 show ReactiveQuery usage patterns with Zero.js integration
- 5-minute TTL caching pattern established

**ReactiveQuery Classes**: `frontend/src/lib/zero/reactive-query.svelte`
- Contains existing ReactiveQuery and ReactiveQueryOne implementations
- Must integrate with these classes, not replace them
- Reactive state management with Svelte 5 integration

**Zero.js Integration**: `frontend/src/lib/zero/zero-client.ts`
- `getZero()` function for client access
- Error handling patterns for connection availability

### Implementation Strategy

1. **Mirror ActiveRecord API Exactly**: ReactiveRecord should have identical method signatures to ActiveRecord, but return ReactiveQuery objects instead of Promises
2. **Reuse Existing ReactiveQuery Infrastructure**: Don't rebuild reactive state management, integrate with existing ReactiveQuery/ReactiveQueryOne classes
3. **Maintain Zero.js Integration Patterns**: Follow established patterns in current ReactiveTask implementation
4. **Preserve Current Caching**: Keep 5-minute TTL pattern from current implementation
5. **Support Method Chaining**: Implement ReactiveScopedQuery for Rails-like chaining

### Critical Requirements from Epic-008

- **Rails Compatibility**: Must feel exactly like Rails ActiveRecord for developers
- **Type Safety**: No `as any` casts, full TypeScript support
- **Performance**: Should match or exceed current ReactiveTask performance
- **Svelte Integration**: Seamless integration with Svelte 5 reactive patterns

### Testing

**Test File Location**: `frontend/tests/epic-008-reactive-record.spec.ts`

**Test Standards**:
- Use Playwright test framework
- Mock Zero.js client using established patterns from ActiveRecord tests
- Test reactive behavior with proper async/await patterns
- Test method chaining and scoped queries
- Verify type safety and error handling

**Testing Frameworks and Patterns to Use**:
- Playwright for async testing
- Mock Zero.js client from `frontend/tests/epic-008-active-record.spec.ts` patterns
- Reactive testing utilities for verifying state updates
- Integration testing with actual ReactiveQuery classes

**Specific Testing Requirements**:
- Test all reactive methods return proper ReactiveQuery objects
- Verify Svelte integration with reactive state updates
- Test error scenarios and connection handling
- Performance comparison with current ReactiveTask implementation

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-07-14 | 1.0 | Initial story creation for Epic-008 completion | Quinn (QA Agent) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results

*This section will be populated by QA Agent upon completion review*