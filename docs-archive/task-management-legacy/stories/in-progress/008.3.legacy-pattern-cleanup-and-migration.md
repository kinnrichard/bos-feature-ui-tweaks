# Story 008.3: Legacy Pattern Cleanup and Component Migration

## Status
InProgress

## Story
**As a** developer working with the Epic-008 simplified architecture,
**I want** all legacy patterns removed and components migrated to use Epic-008 patterns exclusively,
**so that** the codebase has consistent Rails-like patterns without confusing multiple ways to accomplish the same task.

## Acceptance Criteria

1. **Remove Legacy Factory Patterns**
   - Delete entire `frontend/src/lib/record-factory/` directory (Epic-007 legacy)
   - Remove TaskInstance usage from all components
   - Remove `createTaskInstance` function calls throughout codebase
   - Clean up factory pattern imports and dependencies

2. **Migrate TaskList Component**
   - Update `frontend/src/lib/components/jobs/TaskList.svelte` to use Epic-008 patterns
   - Replace `createTaskInstance` calls with `Task.find()` or `ReactiveTask.find()`
   - Update imports to use Epic-008 model classes
   - Ensure reactive behavior works correctly with new patterns

3. **Automated Codebase Migration**
   - Run automated scripts to find and replace old patterns
   - Update import statements throughout codebase
   - Replace factory function calls with Epic-008 method calls
   - Verify no old patterns remain in codebase

4. **Testing and Validation**
   - Run full test suite to ensure no functionality is broken
   - Update tests that depend on old patterns
   - Verify performance is maintained or improved
   - Test UI components function correctly with new patterns

5. **Documentation and Training**
   - Update any internal documentation referencing old patterns
   - Create migration guide for future developers
   - Document new Epic-008 import and usage patterns
   - Remove references to deprecated patterns

## Tasks / Subtasks

- [ ] **Analyze Legacy Pattern Usage** (AC: 1, 2)
  - [ ] Find all occurrences of `TaskInstance` in codebase
  - [ ] Find all occurrences of `createTaskInstance` function calls
  - [ ] Identify all files importing from `record-factory/` directory
  - [ ] Document all components using legacy patterns
  - [ ] Create migration plan for each identified usage

- [ ] **Remove Record Factory Directory** (AC: 1)
  - [ ] Backup `frontend/src/lib/record-factory/` directory
  - [ ] Identify any dependencies on record-factory exports
  - [ ] Update imports that reference record-factory
  - [ ] Delete entire `frontend/src/lib/record-factory/` directory
  - [ ] Remove record-factory references from build configurations

- [ ] **Migrate TaskList Component** (AC: 2)
  - [ ] Analyze current `TaskList.svelte` implementation (lines 781, 1051)
  - [ ] Replace `createTaskInstance(taskData as any)` with Epic-008 patterns
  - [ ] Update imports to use `ReactiveTask` for reactive contexts
  - [ ] Test reactive updates work correctly with Epic-008 models
  - [ ] Verify drag-and-drop functionality works with new patterns
  - [ ] Test task creation, updating, and deletion flows

- [ ] **Automated Pattern Migration** (AC: 3)
  - [ ] Create migration script to replace `createTaskInstance` with `Task.find()`
  - [ ] Replace `TaskInstance` class usage with Epic-008 patterns
  - [ ] Update import statements from Zero.js to Epic-008 models
  - [ ] Replace factory pattern usage with ActiveRecord/ReactiveRecord calls
  - [ ] Validate script doesn't break functionality before running

- [ ] **Update Other Components** (AC: 2, 3)
  - [ ] Find all Svelte components using TaskInstance or factory patterns
  - [ ] Update each component to use ReactiveTask for reactive contexts
  - [ ] Update utility functions to use Task for non-reactive contexts
  - [ ] Ensure proper error handling with new patterns
  - [ ] Test each updated component individually

- [ ] **Clean Up Zero.js Exports** (AC: 1, 3)
  - [ ] Remove TaskInstance exports from Zero.js generated files if possible
  - [ ] Clean up unused factory function exports
  - [ ] Remove imports of legacy patterns from generated files
  - [ ] Update any Zero.js generation configuration to exclude deprecated patterns

- [ ] **Test Migration Results** (AC: 4)
  - [ ] Run full Epic-008 test suite
  - [ ] Run application-wide integration tests
  - [ ] Test TaskList component functionality thoroughly
  - [ ] Verify reactive updates work correctly
  - [ ] Test error scenarios and edge cases
  - [ ] Performance testing to ensure no regressions

- [ ] **Validate Complete Migration** (AC: 3, 4)
  - [ ] Search codebase for any remaining `TaskInstance` references
  - [ ] Search for any remaining `createTaskInstance` calls
  - [ ] Search for any remaining `record-factory` imports
  - [ ] Verify Epic-008 patterns are used consistently
  - [ ] Run linting and type-checking to catch any issues

- [ ] **Update Documentation** (AC: 5)
  - [ ] Update any README files mentioning old patterns
  - [ ] Create migration guide documenting changes made
  - [ ] Update code comments referencing deprecated patterns
  - [ ] Document new Epic-008 usage patterns for team
  - [ ] Remove references to deprecated patterns from documentation

## Dev Notes

### Relevant Source Tree Information

**Epic-008 Specification**: `/Users/claude/code/bos/docs/epics/completed/Epic-008-Simplify-ReactiveRecord-Version-2.md`
- Lines 759-803 show migration scripts and cleanup requirements
- Lines 735-757 show automated import replacement patterns
- Lines 1019-1024 show success criteria for pattern elimination

**TaskList Component**: `frontend/src/lib/components/jobs/TaskList.svelte`
- Lines 781, 1051 contain `createTaskInstance` usage that needs migration
- This is the primary component using legacy patterns
- Must be updated to use ReactiveTask for reactive behavior

**Record Factory Directory**: `frontend/src/lib/record-factory/`
- Contains Epic-007 legacy implementation that conflicts with Epic-008
- Entire directory should be removed as it creates pattern confusion
- Files include: `active-record.ts`, `base-record.ts`, `model-config.ts`, `zero-integration.ts`

**Zero.js Generated Code**: `frontend/src/lib/zero/task.generated.ts`
- Lines 601, 690 contain TaskInstance class and createTaskInstance function
- These exports need to be cleaned up or made internal-only
- Generated code should not expose deprecated patterns

**Migration Scripts**: Epic-008 specification shows required migration patterns
- Replace `createTaskInstance` with `Task.find()`
- Replace factory imports with Epic-008 model imports
- Update Svelte components to use ReactiveTask alias

### Current Legacy Pattern Issues

**TaskList Component Usage** (TaskList.svelte:781, 1051):
```typescript
// CURRENT PROBLEMATIC PATTERN
const { createTaskInstance } = await import('$lib/zero/task.generated');
const taskInstance = createTaskInstance(taskData as any);
```

**Should become Epic-008 pattern**:
```typescript
// EPIC-008 PATTERN
import { ReactiveTask as Task } from '$lib/models/reactive-task';
const taskQuery = Task.find(taskData.id);
```

**Record Factory Pattern** (record-factory/ directory):
- Entire directory represents Epic-007 implementation that conflicts with Epic-008
- Creates confusion by providing alternative ActiveRecord implementation
- Must be removed to eliminate pattern duplication

### Implementation Strategy

1. **Safety First**: Backup all code before making changes
2. **Incremental Migration**: Migrate one component at a time, testing each change
3. **Automated Scripts**: Use sed/regex for bulk find-replace operations
4. **Validation**: Run tests after each major change to catch regressions early
5. **Final Cleanup**: Remove deprecated exports only after confirming nothing uses them

### Migration Script Patterns

Based on Epic-008 specification (lines 762-777):
```bash
# Replace TaskInstance usage
find src -name "*.ts" -o -name "*.svelte" | xargs sed -i 's/createTaskInstance/Task.find/g'

# Replace factory patterns  
find src -name "*.ts" -o -name "*.svelte" | xargs sed -i 's/createActiveModel.*task.*tasks/import { Task } from "$lib\/models\/task"/g'

# Replace reactive factory patterns
find src -name "*.ts" -o -name "*.svelte" | xargs sed -i 's/createReactiveModel.*task.*tasks/import { ReactiveTask as Task } from "$lib\/models\/reactive-task"/g'
```

### Critical Requirements from Epic-008

- **Complete Pattern Elimination**: No TaskInstance or factory patterns should remain
- **Component Functionality**: All UI components must work identically after migration
- **Performance**: No performance regressions from pattern changes
- **Type Safety**: Maintain or improve TypeScript type safety
- **Reactive Behavior**: Ensure Svelte reactive updates continue working

### Testing

**Test File Location**: `frontend/tests/epic-008-integration.spec.ts`

**Test Standards**:
- Test all migrated components for functionality
- Verify reactive behavior works correctly
- Test error scenarios and edge cases
- Performance testing to ensure no regressions

**Testing Frameworks and Patterns to Use**:
- Playwright for component testing
- Integration tests for full user workflows  
- Performance benchmarks comparing before/after migration
- Regression testing for all CRUD operations

**Specific Testing Requirements**:
- Test TaskList component functionality after migration
- Verify drag-and-drop still works correctly
- Test task creation, editing, and deletion workflows
- Verify reactive updates happen automatically
- Test error handling with new patterns
- Confirm no memory leaks or performance issues

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-07-14 | 1.0 | Initial story creation for Epic-008 legacy cleanup | Quinn (QA Agent) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results

*This section will be populated by QA Agent upon completion review*