# Story 008.2: Complete Epic-008 Model Generation

## Status
InProgress

## Story
**As a** Rails developer working with the Epic-008 architecture,
**I want** properly generated Epic-008 model classes that extend ActiveRecord and ReactiveRecord base classes,
**so that** I can use familiar Rails patterns with true class inheritance instead of hybrid re-export patterns.

## Acceptance Criteria

1. **Replace Hybrid Re-Export Pattern**
   - Remove current hybrid re-export pattern from `frontend/src/lib/models/task.ts`
   - Generate true Epic-008 classes: `Task extends ActiveRecord<TaskData>` and `ReactiveTask extends ReactiveRecord<TaskData>`
   - Eliminate confusion between Zero.js exports and Epic-008 patterns
   - Maintain backward compatibility during transition

2. **Rails Generator Execution**
   - Run `rails generate zero:active_models` to generate Epic-008 model classes
   - Generate both ActiveRecord and ReactiveRecord versions for all models
   - Ensure generated models follow Epic-008 specification exactly
   - Verify TypeScript interfaces are properly generated

3. **Model Class Implementation**
   - Generated Task class must extend ActiveRecord base class with proper configuration
   - Generated ReactiveTask class must extend ReactiveRecord base class
   - Include domain-specific methods (e.g., `isCompleted`, `complete()`, `completed()` scope)
   - Support discard gem functionality (`discard()`, `undiscard()`, `kept()`, `discarded()`)
   - Include positioning methods for acts_as_list integration

4. **Type Safety and Interface Generation**
   - Generate proper TypeScript interfaces for all model data types
   - Ensure full type safety with no `as any` casts
   - Maintain compatibility with existing Zero.js generated types
   - Support proper generic typing for base class methods

5. **Import Pattern Standardization**
   - Update barrel exports in `frontend/src/lib/models/index.ts`
   - Establish clear import patterns for reactive vs non-reactive contexts
   - Remove confusing mixed exports from hybrid pattern
   - Document new import conventions

## Tasks / Subtasks

- [ ] **Analyze Current Rails Generator** (AC: 2)
  - [ ] Verify `lib/generators/zero/active_models/active_models_generator.rb` is Epic-008 ready
  - [ ] Check ERB templates for ActiveRecord and ReactiveRecord generation
  - [ ] Confirm generator produces proper Epic-008 class structure
  - [ ] Test generator with `--dry-run` flag first

- [ ] **Generate Epic-008 Model Classes** (AC: 1, 2, 3)
  - [ ] Run `rails generate zero:active_models --table=tasks` to generate Task models
  - [ ] Verify generated `Task` class extends `ActiveRecord<TaskData>`
  - [ ] Verify generated `ReactiveTask` class extends `ReactiveRecord<TaskData>`
  - [ ] Check generated TypeScript interfaces match Zero.js schema
  - [ ] Validate domain-specific methods are included in generated classes

- [ ] **Replace Hybrid Re-Export Pattern** (AC: 1)
  - [ ] Backup current `frontend/src/lib/models/task.ts`
  - [ ] Replace hybrid re-exports with generated Epic-008 classes
  - [ ] Remove old TaskInstance and factory function exports
  - [ ] Update imports to use new Epic-008 patterns
  - [ ] Ensure no breaking changes to existing functionality

- [ ] **Add Domain-Specific Methods** (AC: 3)
  - [ ] Implement `isCompleted` getter in Task class
  - [ ] Add `complete()` instance method
  - [ ] Add `markInProgress()` instance method  
  - [ ] Implement `completed()` static scope method
  - [ ] Add `forJob(jobId)` static scope method
  - [ ] Include positioning methods (`moveToTop()`, `moveAfter()`)

- [ ] **Update Type Definitions** (AC: 4)
  - [ ] Generate proper `TaskData` interface
  - [ ] Create `CreateTaskData` and `UpdateTaskData` types
  - [ ] Ensure compatibility with existing Zero.js types
  - [ ] Remove any `as any` type casts
  - [ ] Validate full TypeScript compilation

- [ ] **Update Import/Export Patterns** (AC: 5)
  - [ ] Update `frontend/src/lib/models/index.ts` barrel exports
  - [ ] Export non-reactive models as default exports
  - [ ] Export reactive models with explicit naming
  - [ ] Remove old factory function exports
  - [ ] Document new import conventions in comments

- [ ] **Extend to Other Models** (AC: 2, 3)
  - [ ] Generate Epic-008 classes for Job model
  - [ ] Generate Epic-008 classes for User model  
  - [ ] Generate Epic-008 classes for all other models in schema
  - [ ] Verify all models follow consistent Epic-008 patterns
  - [ ] Update all model exports in index.ts

- [ ] **Integration Testing** (AC: 1, 2, 3, 4)
  - [ ] Run existing Epic-008 test suite to verify compatibility
  - [ ] Test Rails-style CRUD operations work correctly
  - [ ] Verify reactive queries function properly
  - [ ] Test discard gem functionality
  - [ ] Test domain-specific methods and scopes

## Dev Notes

### Relevant Source Tree Information

**Epic-008 Specification**: `/Users/claude/code/bos/docs/epics/completed/Epic-008-Simplify-ReactiveRecord-Version-2.md`
- Lines 298-346 show expected Task model implementation
- Lines 349-363 show expected ReactiveTask implementation  
- Lines 391-425 show required import/export patterns
- Lines 459-509 show Rails generator template requirements

**Current Hybrid Implementation**: `frontend/src/lib/models/task.ts`
- Lines 16-32 show hybrid re-export pattern that needs replacement
- This file should be completely rewritten with generated Epic-008 classes

**Rails Generator**: `lib/generators/zero/active_models/active_models_generator.rb`
- Contains Epic-008 compliant templates and generation logic
- Should produce proper ActiveRecord and ReactiveRecord extending classes
- Includes ERB templates for TypeScript generation

**ActiveRecord Base Class**: `frontend/src/lib/models/base/active-record.ts`
- Lines 239-435 show base class that generated models should extend
- Configuration interface at lines 26-33 shows required setup
- Generated models must follow this inheritance pattern

**Zero.js Generated Code**: `frontend/src/lib/zero/task.generated.ts`
- Contains existing TaskInstance and factory patterns to replace
- Generated Epic-008 models should integrate with, not replace, Zero.js data layer
- TypeScript interfaces should be compatible with Zero.js schema

### Current Problem Analysis

**Hybrid Re-Export Pattern Issues**:
```typescript
// CURRENT PROBLEMATIC PATTERN (task.ts:16-32)
export {
  Task,                    // Zero.js interface, not Epic-008 class
  TaskInstance,           // Old factory pattern
  createTaskInstance,     // Old factory function
  // ... more hybrid exports
} from '../zero/task.generated';
```

**Expected Epic-008 Pattern**:
```typescript
// WHAT SHOULD BE GENERATED
export class Task extends ActiveRecord<TaskData> {
  static tableName = 'tasks';
  
  get isCompleted(): boolean {
    return this.data.status === 'completed';
  }
  
  async complete(): Promise<boolean> {
    return this.update({ status: 'completed' });
  }
  
  static async completed(): Promise<Task[]> {
    return this.where({ status: 'completed' });
  }
}
```

### Implementation Strategy

1. **Generate First, Test Second**: Run Rails generator to create Epic-008 classes, then verify they work
2. **Incremental Replacement**: Replace hybrid pattern file by file, starting with Task
3. **Maintain Compatibility**: Ensure existing functionality works during transition
4. **Extend Gradually**: Add other models after Task is successfully converted
5. **Update Imports Last**: Update barrel exports and import patterns after all models converted

### Critical Requirements from Epic-008

- **Rails Class Inheritance**: Models must extend base classes, not re-export Zero.js code
- **Domain Methods**: Include task-specific business logic methods
- **Type Safety**: Full TypeScript support without any type casts
- **Backward Compatibility**: Don't break existing functionality during transition

### Testing

**Test File Location**: `frontend/tests/epic-008-generated-models.spec.ts`

**Test Standards**:
- Verify generated classes extend proper base classes
- Test all Rails-style CRUD operations
- Verify domain-specific methods work correctly
- Test TypeScript compilation and type safety

**Testing Frameworks and Patterns to Use**:
- Playwright for async model testing
- Use Epic-008 test infrastructure from existing test files
- Mock Zero.js client for isolated model testing
- Integration tests with real Zero.js backend

**Specific Testing Requirements**:
- Test `Task extends ActiveRecord` inheritance works
- Test `ReactiveTask extends ReactiveRecord` inheritance works  
- Verify Rails-style methods (`find`, `where`, `create`, etc.)
- Test domain-specific methods (`complete()`, `isCompleted`)
- Test discard gem functionality
- Verify import patterns work correctly

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-07-14 | 1.0 | Initial story creation for Epic-008 model generation | Quinn (QA Agent) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results

*This section will be populated by QA Agent upon completion review*